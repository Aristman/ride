<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin>
    <!-- Unique identifier of the plugin. It should be FQN. It cannot be changed between the plugin versions. -->
    <id>ru.marslab.ide.ride</id>

    <!-- Public plugin name should be written in Title Case.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html#plugin-name -->
    <name>Ride</name>

    <!-- A displayed Vendor name or Organization ID displayed on the Plugins Page. -->
    <vendor email="your.email@example.com" url="https://github.com/yourusername/ride">MarsLab</vendor>

    <!-- Description of the plugin displayed on the Plugin Page and IDE Plugin Manager.
         Guidelines: https://plugins.jetbrains.com/docs/marketplace/best-practices-for-listing.html#plugin-description -->
    <description><![CDATA[
        <h2>Ride - AI-ассистент для разработчиков</h2>
        
        <p>Интерактивный чат с AI прямо в вашей IDE! Получайте помощь с кодом, отладкой и разработкой через интеграцию с Yandex GPT.</p>
        
        <h3>Основные возможности:</h3>
        <ul>
            <li><strong>Интерактивный чат</strong> - общайтесь с AI-ассистентом прямо в IDE</li>
            <li><strong>Yandex GPT интеграция</strong> - качественные ответы на русском и английском языках</li>
            <li><strong>История диалогов</strong> - сохранение контекста в рамках сессии</li>
            <li><strong>Безопасность</strong> - API ключи хранятся в PasswordSafe</li>
            <li><strong>Асинхронность</strong> - не блокирует работу IDE</li>
            <li><strong>Настройки</strong> - гибкая настройка промптов и параметров генерации</li>
        </ul>
        
        <h3>Как использовать:</h3>
        <ol>
            <li>Получите API ключ от Yandex Cloud</li>
            <li>Настройте плагин в Settings → Tools → Ride</li>
            <li>Откройте Tool Window "Ride Chat"</li>
            <li>Задавайте вопросы и получайте ответы!</li>
        </ol>
        
        <p><strong>Требования:</strong> IntelliJ IDEA 2024.3+ или Android Studio 2024.3+, JDK 21, Yandex Cloud аккаунт</p>
        
        <p><strong>Примечание:</strong> Для подсветки синтаксиса кода требуется JetBrains Runtime (JBR) с поддержкой JCEF. 
        В Android Studio для активации JCEF перейдите в Settings → Appearance & Behavior → System Settings → HTTP Proxy и убедитесь, что используется встроенный JBR.</p>
        
        <p>Исходный код: <a href="https://github.com/yourusername/ride">GitHub</a></p>
    ]]></description>

    <!-- Product and plugin compatibility requirements.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-compatibility.html -->
    <depends>com.intellij.modules.platform</depends>

    <!-- Exclude problematic plugins that cause startup issues -->
    <depends optional="true" config-file="gradle-exclude.xml">com.intellij.gradle</depends>

    <!-- Extension points defined by the plugin.
         Read more: https://plugins.jetbrains.com/docs/intellij/plugin-extension-points.html -->
    <extensions defaultExtensionNs="com.intellij">
        <!-- Tool Windows -->
        <toolWindow id="Ride Chat" 
                    anchor="right" 
                    factoryClass="ru.marslab.ide.ride.ui.ChatToolWindowFactory"
                    icon="AllIcons.General.User"/>
        
        <toolWindow id="MCP Methods" 
                    anchor="right" 
                    factoryClass="ru.marslab.ide.ride.ui.mcp.MCPToolWindowFactory"
                    icon="AllIcons.Actions.ListFiles"/>
        
        <!-- Settings -->
        <applicationConfigurable 
                parentId="tools"
                instance="ru.marslab.ide.ride.settings.SettingsConfigurable"
                id="ru.marslab.ide.ride.settings.SettingsConfigurable"
                displayName="Ride"/>
        
        <!-- MCP Settings (sub-page under Ride) -->
        <projectConfigurable
                parentId="ru.marslab.ide.ride.settings.SettingsConfigurable"
                instance="ru.marslab.ide.ride.settings.MCPSettingsConfigurable"
                id="ru.marslab.ide.ride.settings.MCPSettingsConfigurable"
                displayName="MCP Servers"/>
        
        <!-- Application Services -->
        <applicationService
                serviceImplementation="ru.marslab.ide.ride.settings.PluginSettings"/>
        <applicationService
                serviceImplementation="ru.marslab.ide.ride.service.ChatService"/>

        <!-- Project Services -->
        <projectService
                serviceImplementation="ru.marslab.ide.ride.service.mcp.MCPConfigService"/>
        <projectService
                serviceImplementation="ru.marslab.ide.ride.service.mcp.MCPConnectionManager"/>
        <projectService
                serviceImplementation="ru.marslab.ide.ride.service.mcp.MCPStatusPersistenceService"/>
    </extensions>

    <!-- Project listeners -->
    <projectListeners>
        <listener class="ru.marslab.ide.ride.mcp.MCPProjectStartupListener"
                  topic="com.intellij.openapi.project.ProjectManagerListener"/>
    </projectListeners>

    
    <!-- Actions registration -->
    <actions>
        <group id="Ride.Menu" text="Ride" description="Ride plugin actions" popup="true">
            <action id="Ride.SetResponseFormatAction"
                    class="ru.marslab.ide.ride.actions.SetResponseFormatAction"
                    text="Set Response Format..."
                    description="Choose agent response format (JSON/XML/TEXT) and optional schema"/>
        </group>

        <!-- Toolbar actions for Tool Window -->
        <group id="Ride.ToolWindowActions" text="Ride Toolbar" popup="false">
            <action id="Ride.NewSessionAction"
                    class="ru.marslab.ide.ride.actions.NewSessionAction"
                    text="New Session"
                    description="Start a new chat session"/>
            <action id="Ride.ReloadSessionAction"
                    class="ru.marslab.ide.ride.actions.ReloadSessionAction"
                    text="Reload"
                    description="Reload current chat session"/>
            <action id="Ride.OpenSettingsAction"
                    class="ru.marslab.ide.ride.actions.OpenSettingsAction"
                    text="Settings"
                    description="Open Ride settings"/>
        </group>
    </actions>
</idea-plugin>