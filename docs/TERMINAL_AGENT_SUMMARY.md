# Terminal Agent - –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

## –ß—Ç–æ —ç—Ç–æ?

**TerminalAgent** - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è shell-–∫–æ–º–∞–Ω–¥ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ IntelliJ IDEA. –†–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Agent` –∏ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, —Ç–∞–∫ –∏ –≤ —Å–æ—Å—Ç–∞–≤–µ —Å–∏—Å—Ç–µ–º—ã –∞–≥–µ–Ω—Ç–æ–≤.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
- **`src/main/kotlin/ru/marslab/ide/ride/agent/impl/TerminalAgent.kt`** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
- **`src/main/kotlin/ru/marslab/ide/ride/model/terminal/TerminalModels.kt`** - –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
- **`src/main/kotlin/ru/marslab/ide/ride/agent/AgentFactory.kt`** - —Ñ–∞–±—Ä–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ `createTerminalAgent()`

### –¢–µ—Å—Ç—ã
- **`src/test/kotlin/ru/marslab/ide/ride/agent/impl/TerminalAgentTest.kt`** - –ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **`docs/features/terminal-agent.md`** - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- **`docs/features/terminal-agent-integration.md`** - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **`docs/features/README.md`** - –æ–±–Ω–æ–≤–ª–µ–Ω —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ Terminal Agent

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
```kotlin
val terminalAgent = AgentFactory.createTerminalAgent()
```

### 2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
```kotlin
val request = AgentRequest(
    request = "git status",
    context = context,
    parameters = LLMParameters.DEFAULT
)
val response = terminalAgent.ask(request)
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```kotlin
if (response.success) {
    println(response.content)  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥
    println(response.metadata["exitCode"])  // 0
    println(response.metadata["executionTime"])  // –≤—Ä–µ–º—è –≤ ms
} else {
    println(response.error)  // –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
}
```

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ `ProcessBuilder`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Windows (cmd) –∏ Unix (sh)
- –ó–∞—Ö–≤–∞—Ç stdout –∏ stderr
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ö–æ–¥—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –¢–∞–π–º–∞—É—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 —Å–µ–∫)
- –ü–æ—Ç–æ–∫–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `start()`
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### üéØ Capabilities
```kotlin
stateful = false        // –ù–µ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
streaming = true        // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ—Ç–æ–∫–∏
reasoning = false       // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM
tools = ["terminal", "shell", "command-execution"]
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∞–≥–µ–Ω—Ç–æ–º

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ ChatService
–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `executeTerminalCommand()` –≤ `ChatService` –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ AgentOrchestrator
–†–∞—Å—à–∏—Ä–∏—Ç—å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏ (—Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏–ª–∏ –æ–±—ã—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å).

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω—ã–π –∞–≥–µ–Ω—Ç
–°–æ–∑–¥–∞—Ç—å `HybridChatAgent`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ —Ä–µ—à–∞–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ.

### –í–∞—Ä–∏–∞–Ω—Ç 4: UI –∫–æ–º–∞–Ω–¥—ã
–î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ `ChatPanel`:
- `/terminal <–∫–æ–º–∞–Ω–¥–∞>` - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
- `/exec <–∫–æ–º–∞–Ω–¥–∞>` - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

```bash
# Git –æ–ø–µ—Ä–∞—Ü–∏–∏
git status
git log -n 5
git diff

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
./gradlew build
./gradlew test

# –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤
find . -name "*.kt" -type f
grep -r "TerminalAgent" src/

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ
pwd
ls -la
echo $PATH
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ IDE
- –ù–µ—Ç –ø–µ—Å–æ—á–Ω–∏—Ü—ã –∏–ª–∏ –∏–∑–æ–ª—è—Ü–∏–∏
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ

### üîí –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. –î–æ–±–∞–≤–∏—Ç—å –±–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
2. –î–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ (rm, del, format –∏ —Ç.–¥.)
3. –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–±–æ—á–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–æ–º
5. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

## –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞

```kotlin
metadata = mapOf(
    "command" to "git status",           // –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
    "exitCode" to 0,                     // –ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    "executionTime" to 123L,             // –í—Ä–µ–º—è –≤ ms
    "workingDir" to "/path/to/project"   // –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
)
```

## –ü–æ—Ç–æ–∫–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

```kotlin
val flow = terminalAgent.start(request)
flow?.collect { event ->
    when (event) {
        is AgentEvent.Started -> showProgress()
        is AgentEvent.ContentChunk -> updateProgress(event.content)
        is AgentEvent.Completed -> hideProgress()
        is AgentEvent.Error -> showError(event.error)
    }
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –≤ `TerminalAgentTest.kt`:
- ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –°–º–µ–Ω–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- ‚úÖ –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –ü–æ—Ç–æ–∫–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- ‚úÖ –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ü—É—Å—Ç—ã–µ –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –í—ã–≤–æ–¥ –≤ stderr

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
TerminalAgent
‚îú‚îÄ‚îÄ ask(request) -> AgentResponse
‚îÇ   ‚îú‚îÄ‚îÄ parseCommandFromRequest()
‚îÇ   ‚îú‚îÄ‚îÄ executeCommand()
‚îÇ   ‚îî‚îÄ‚îÄ formatCommandResult()
‚îÇ
‚îú‚îÄ‚îÄ start(request) -> Flow<AgentEvent>
‚îÇ   ‚îî‚îÄ‚îÄ executeCommandStreaming()
‚îÇ
‚îî‚îÄ‚îÄ capabilities: AgentCapabilities
```

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

```kotlin
TerminalCommand(
    command: String,
    workingDir: String? = null,
    timeout: Long = 30000L,
    environmentVariables: Map<String, String> = emptyMap()
)

TerminalCommandResult(
    command: String,
    exitCode: Int,
    stdout: String,
    stderr: String,
    executionTime: Long,
    success: Boolean
)
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
1. –í—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (—Å–º. `terminal-agent-integration.md`)
2. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ `ChatService` –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å `AgentOrchestrator`
3. –û–±–Ω–æ–≤–∏—Ç—å UI –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
4. –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥

### –î–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–º–∞–Ω–¥
2. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
3. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
4. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥)
2. –ú–∞–∫—Ä–æ—Å—ã —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–∞–Ω–¥
3. –ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
4. –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥

## –°—Å—ã–ª–∫–∏

- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é](features/terminal-agent.md)
- [–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](features/terminal-agent-integration.md)
- [–°–ø–∏—Å–æ–∫ —Ñ–∏—á](features/README.md)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](architecture/overview.md)

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-18  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞
