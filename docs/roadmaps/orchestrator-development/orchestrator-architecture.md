# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–∞-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

## –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### High-level –¥–∏–∞–≥—Ä–∞–º–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  ChatAgent UI    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  ChatService    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                        ‚îÇ
                                                       ‚îå‚î¥‚îê
                                                       ‚îÇ‚ñº‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Tool Agents     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ Orchestrator     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÇ Enhanced        ‚îÇ
‚îÇ (CodeAnalysis,  ‚îÇ    ‚îÇ Agent            ‚îÇ    ‚îÇ ChatAgent       ‚îÇ
‚îÇ CodeFix, etc.)  ‚îÇ    ‚îÇ                  ‚îÇ    ‚îÇ                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ LLM Providers   ‚îÇ    ‚îÇ Plan Storage     ‚îÇ    ‚îÇ Plugin Settings ‚îÇ
‚îÇ (Yandex, HF)    ‚îÇ    ‚îÇ (Memory/DB)      ‚îÇ    ‚îÇ & Configuration ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Core –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. OrchestratorAgent

```kotlin
class OrchestratorAgentImpl(
    private val requestAnalyzer: RequestAnalyzer,
    private val planGenerator: PlanGenerator,
    private val planExecutor: PlanExecutor,
    private val planStorage: PlanStorage,
    private val progressTracker: ProgressTracker,
    private val toolAgentRegistry: ToolAgentRegistry
) : OrchestratorAgent {

    override suspend fun orchestrate(request: UserRequest): OrchestratedResponse {
        // 1. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å
        val analysis = requestAnalyzer.analyze(request)

        // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–ª–∞–Ω
        val plan = planGenerator.generate(analysis)

        // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–ª–∞–Ω
        planStorage.save(plan)

        // 4. –ù–∞—á–∏–Ω–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        return when {
            plan.requiresUserInput ->
                OrchestratedResponse.requiresInput(plan, plan.getNextUserPrompt())
            else ->
                executePlan(plan)
        }
    }

    override suspend fun resumePlan(planId: String, userInput: String): OrchestratedResponse {
        val plan = planStorage.load(planId)
        plan.updateWithUserInput(userInput)
        return executePlan(plan)
    }
}
```

### 2. RequestAnalyzer

```kotlin
class RequestAnalyzer(
    private val llmProvider: LLMProvider
) {
    suspend fun analyze(request: UserRequest): RequestAnalysis {
        val prompt = buildAnalysisPrompt(request)
        val response = llmProvider.sendRequest(prompt)

        return RequestAnalysis.fromLLMResponse(response).apply {
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞
            validateCapabilities()
            enrichWithProjectContext(request.context)
        }
    }

    private fun buildAnalysisPrompt(request: UserRequest): String {
        return """
            –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–ø—Ä–µ–¥–µ–ª–∏:
            1. –¢–∏–ø –∑–∞–¥–∞—á–∏ (–∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞, —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞)
            2. –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (CodeAnalysis, FileOperations, etc.)
            3. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç (—Ñ–∞–π–ª—ã, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∫—Ä–∏—Ç–µ—Ä–∏–∏)
            4. –¢–æ—á–∫–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            5. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

            –ó–∞–ø—Ä–æ—Å: "${request.text}"
            –ö–æ–Ω—Ç–µ–∫—Å—Ç: ${request.context.description}
        """.trimIndent()
    }
}
```

### 3. PlanGenerator

```kotlin
class PlanGenerator {
    suspend fun generate(analysis: RequestAnalysis): ExecutionPlan {
        val steps = mutableListOf<PlanStep>()
        val planId = generatePlanId()

        when (analysis.taskType) {
            TaskType.CODE_ANALYSIS -> generateCodeAnalysisSteps(steps, analysis)
            TaskType.BUG_FIXING -> generateBugFixingSteps(steps, analysis)
            TaskType.REPORT_GENERATION -> generateReportSteps(steps, analysis)
            // ... –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –∑–∞–¥–∞—á
        }

        return ExecutionPlan(
            id = planId,
            description = analysis.description,
            steps = steps,
            status = PlanStatus.CREATED,
            context = analysis.context,
            metadata = PlanMetadata(
                estimatedDuration = estimateDuration(steps),
                requiredUserInputs = countUserInteractions(steps),
                riskLevel = calculateRiskLevel(steps)
            )
        )
    }

    private fun generateCodeAnalysisSteps(steps: MutableList<PlanStep>, analysis: RequestAnalysis) {
        // –®–∞–≥ 1: –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
        steps.add(
            PlanStep(
                id = "scan-project",
                description = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–µ–∫—Ç–∞",
                agentType = AgentType.PROJECT_SCANNER,
                input = StepInput.mapOf(
                    "patterns" to analysis.inclusionPatterns,
                    "exclude_patterns" to analysis.exclusionPatterns
                ),
                dependencies = emptySet(),
                status = StepStatus.PENDING
            )
        )

        // –®–∞–≥ 2: –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
        steps.add(
            PlanStep(
                id = "analyze-code",
                description = "–ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã",
                agentType = AgentType.CODE_ANALYSIS,
                input = StepInput.dependsOn("scan-project"),
                dependencies = setOf("scan-project"),
                status = StepStatus.PENDING
            )
        )

        // –®–∞–≥ 3: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        steps.add(
            PlanStep(
                id = "user-confirmation",
                description = "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º",
                agentType = AgentType.USER_INTERACTION,
                input = StepInput.dependsOn("analyze-code"),
                dependencies = setOf("analyze-code"),
                status = StepStatus.PENDING
            )
        )
    }
}
```

### 4. PlanExecutor

```kotlin
class PlanExecutor(
    private val toolAgents: Map<AgentType, ToolAgent>,
    private val progressTracker: ProgressTracker
) {
    suspend fun executePlan(plan: ExecutionPlan): OrchestratedResponse {
        plan.status = PlanStatus.IN_PROGRESS
        progressTracker.startTracking(plan)

        return try {
            // –í—ã–ø–æ–ª–Ω—è–µ–º —à–∞–≥–∏ —Å —É—á–µ—Ç–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
            val completedSteps = executeStepsWithDependencies(plan)

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            val result = compileFinalResult(completedSteps, plan)

            plan.status = PlanStatus.COMPLETED
            progressTracker.completePlan(plan)

            OrchestratedResponse.success(result, plan)
        } catch (e: Exception) {
            plan.status = PlanStatus.FAILED
            progressTracker.failPlan(plan, e)

            OrchestratedResponse.error(e.message ?: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞", plan)
        }
    }

    private suspend fun executeStepsWithDependencies(plan: ExecutionPlan): List<CompletedStep> {
        val completedSteps = mutableListOf<CompletedStep>()
        val stepGraph = buildDependencyGraph(plan.steps)

        // –í—ã–ø–æ–ª–Ω—è–µ–º —à–∞–≥–∏ –≤ —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ
        for (stepBatch in stepGraph.executionOrder) {
            val batchResults = stepBatch.map { step ->
                executeStep(step, plan.context, completedSteps)
            }
            completedSteps.addAll(batchResults)

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
            val userInputStep = batchResults.find { it.requiresUserInput }
            if (userInputStep != null) {
                return completedSteps // –ü–∞—É–∑–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
            }
        }

        return completedSteps
    }

    private suspend fun executeStep(
        step: PlanStep,
        context: ExecutionContext,
        completedSteps: List<CompletedStep>
    ): CompletedStep {
        step.status = StepStatus.IN_PROGRESS
        progressTracker.updateStepProgress(step, 0.0)

        return try {
            val agent = toolAgents[step.agentType]
                ?: throw IllegalStateException("Agent not found: ${step.agentType}")

            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —à–∞–≥–æ–≤
            val enrichedInput = enrichStepInput(step, completedSteps)

            val result = agent.executeStep(step.copy(input = enrichedInput), context)

            step.status = StepStatus.COMPLETED
            step.output = result.output
            progressTracker.completeStep(step)

            CompletedStep(step, result)
        } catch (e: Exception) {
            step.status = StepStatus.FAILED
            step.error = e.message
            progressTracker.failStep(step, e)

            throw e
        }
    }
}
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ê–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤

**–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
> "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –º–æ–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ –±–∞–≥–∏ –∏ –∏—Å–ø—Ä–∞–≤—å –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã"

**–ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

1. **–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞:**

```
TaskType: COMPLEX_ANALYSIS_AND_FIX
RequiredTools: [PROJECT_SCANNER, CODE_ANALYSIS, CODE_FIXER, USER_INTERACTION]
Scope: –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç
UserInteractions: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
```

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞:**

```kotlin
ExecutionPlan(
    id = "plan-123",
    description = "–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –±–∞–≥–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º",
    steps = [
        PlanStep(
            id = "scan-project",
            description = "–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã",
            agentType = PROJECT_SCANNER,
            dependencies = []
        ),
        PlanStep(
            id = "analyze-bugs",
            description = "–ü–æ–∏—Å–∫ –±–∞–≥–æ–≤ –≤ –∫–æ–¥–µ",
            agentType = CODE_ANALYSIS,
            dependencies = ["scan-project"]
        ),
        PlanStep(
            id = "classify-issues",
            description = "–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º",
            agentType = ISSUE_CLASSIFIER,
            dependencies = ["analyze-bugs"]
        ),
        PlanStep(
            id = "user-confirmation",
            description = "–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
            agentType = USER_INTERACTION,
            dependencies = ["classify-issues"]
        ),
        PlanStep(
            id = "fix-critical",
            description = "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º",
            agentType = CODE_FIXER,
            dependencies = ["user-confirmation"]
        ),
        PlanStep(
            id = "generate-report",
            description = "–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ",
            agentType = REPORT_GENERATOR,
            dependencies = ["fix-critical"]
        )
    ]
)
```

3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —á–∞—Ç–µ:**

```
–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: –ù–∞—á–∏–Ω–∞—é –∞–Ω–∞–ª–∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –±–∞–≥–æ–≤...

üîç –°–∫–∞–Ω–∏—Ä—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É...
‚úÖ –ù–∞–π–¥–µ–Ω–æ 127 —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∫–æ–¥ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ–±–ª–µ–º...
‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 15 –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º:
- 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö (null pointer exceptions)
- 7 –≤—ã—Å–æ–∫–∏—Ö (resource leaks)
- 5 —Å—Ä–µ–¥–Ω–∏—Ö (code smells)

‚ùì –ù–∞–π–¥–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã. –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?
[–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏] [–ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å—ë] [–û—Ç–º–µ–Ω–∞]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏

–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. FileService.kt:45 - Potential NPE when user is null
2. DatabaseManager.kt:123 - Resource leak: connection not closed
3. CacheManager.kt:67 - Race condition in concurrent access

–ò—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–∏ 3 –ø—Ä–æ–±–ª–µ–º—ã?
[–î–∞] [–ù–µ—Ç] [–ü–æ–∫–∞–∑–∞—Ç—å –±–æ–ª—å—à–µ]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –î–∞

–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: üîß –ò—Å–ø—Ä–∞–≤–ª—è—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã...
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ FileService.kt:45
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ DatabaseManager.kt:123
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ CacheManager.kt:67

üìã –°–æ–∑–¥–∞—é –æ—Ç—á–µ—Ç...
‚úÖ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ reports/bug-fix-2024-01-15.md

–ì–æ—Ç–æ–≤–æ! –ò—Å–ø—Ä–∞–≤–∏–ª 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –≤ –≤–∞—à–µ–º –∫–æ–¥–µ.
```

### –ü—Ä–∏–º–µ—Ä 2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
> "–ü–µ—Ä–µ–Ω–µ—Å–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏–∑ UI –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π"

**–ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

1. **–ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–∞:**

```
TaskType: ARCHITECTURE_REFACTORING
RequiredTools: [ARCHITECTURE_ANALYZER, CODE_EXTRACTOR, SERVICE_GENERATOR, FILE_MANAGER]
Scope: UI –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
UserInteractions: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ extracted –ª–æ–≥–∏–∫–∏, –≤—ã–±–æ—Ä –∏–º–µ–Ω —Å–µ—Ä–≤–∏—Å–æ–≤
```

2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞:**

```kotlin
ExecutionPlan(
    steps = [
        PlanStep("analyze-architecture", "–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã", ARCHITECTURE_ANALYZER),
        PlanStep("identify-business-logic", "–ü–æ–∏—Å–∫ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ UI", CODE_ANALYZER),
        PlanStep("extract-logic", "–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏", CODE_EXTRACTOR),
        PlanStep("user-confirm", "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏", USER_INTERACTION),
        PlanStep("generate-services", "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤", SERVICE_GENERATOR),
        PlanStep("update-controllers", "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤", CODE_MODIFIER),
        PlanStep("verify-compilation", "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏", COMPILATION_CHECKER)
    ]
)
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

### –ê–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤

```kotlin
class CodeAnalysisToolAdapter(
    private val codeAnalysisAgent: CodeAnalysisAgent
) : ToolAgent {

    override val agentType = AgentType.CODE_ANALYSIS
    override val capabilities = setOf("bug_detection", "quality_analysis", "architecture_analysis")

    override suspend fun executeStep(step: PlanStep, context: ExecutionContext): StepResult {
        val analysisType = when (step.input.getString("analysis_type")) {
            "bugs" -> AnalysisType.BUG_DETECTION
            "quality" -> AnalysisType.CODE_QUALITY
            "architecture" -> AnalysisType.ARCHITECTURE
            else -> AnalysisType.ALL
        }

        val files = when {
            step.input.contains("files") -> step.input.getList<String>("files")
            step.input.contains("scan_result") -> {
                val scanResult = step.input.getObject<ScanResult>("scan_result")
                scanResult.files
            }
            else -> emptyList()
        }

        val result = codeAnalysisAgent.analyze(
            type = analysisType,
            files = files,
            context = context
        )

        return StepResult.success(
            output = StepOutput.mapOf(
                "analysis_result" to result,
                "issues_found" to result.issues.size,
                "critical_issues" to result.issues.count { it.severity == Severity.CRITICAL }
            )
        )
    }
}
```

### –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ChatAgent

```kotlin
class EnhancedChatAgent(
    private val baseAgent: ChatAgent,
    private val orchestrator: OrchestratorAgent
) : ChatAgent by baseAgent {

    override suspend fun ask(request: AgentRequest): AgentResponse {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
        return when {
            isComplexTask(request.request) -> handleWithOrchestrator(request)
            else -> baseAgent.ask(request)
        }
    }

    private suspend fun handleWithOrchestrator(request: AgentRequest): AgentResponse {
        val userRequest = UserRequest.fromAgentRequest(request)
        val orchestratedResponse = orchestrator.orchestrate(userRequest)

        return when (orchestratedResponse.type) {
            OrchestratedResponseType.SUCCESS -> formatSuccessResponse(orchestratedResponse)
            OrchestratedResponseType.REQUIRES_INPUT -> formatInputRequest(orchestratedResponse)
            OrchestratedResponseType.IN_PROGRESS -> formatProgressResponse(orchestratedResponse)
            OrchestratedResponseType.ERROR -> formatErrorResponse(orchestratedResponse)
        }
    }

    private fun isComplexTask(request: String): Boolean {
        val complexKeywords = listOf("–ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π", "–∏—Å–ø—Ä–∞–≤—å", "—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥", "–ø–µ—Ä–µ–Ω–µ—Å–∏", "—Å–æ–∑–¥–∞–π –æ—Ç—á–µ—Ç")
        return complexKeywords.any { keyword ->
            request.lowercase().contains(keyword)
        } && request.length > 20
    }
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç —á–µ—Ç–∫—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
2. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ tool agents
3. **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
4. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á
5. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
6. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–æ—â–Ω—É—é –æ—Å–Ω–æ–≤—É –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö –∑–∞–¥–∞—á, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º –ø—Ä–æ—Å—Ç–æ–π –∏
–∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ —á–∞—Ç.